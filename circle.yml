machine:
  python:
    version: 3.5.1
  services:
    - redis
  environment:
    DEBUG: 'true'
    DEFAULT_FORK: 'open-craft/edx-platform'
    INSTANCE_EPHEMERAL_DATABASES: 'false'
    LOAD_BALANCER_FRAGMENT_NAME_PREFIX: 'integration-'
    # We make the tests upload files to a testing SWIFT account so that the simple_theme role of the deployed instance can download them later. This container should contain the default images (logo and favicon) just as the real one would.
    MEDIAFILES_SWIFT_ENABLE: 'true'
    MEDIAFILES_SWIFT_AUTH_URL: 'https://auth.cloud.ovh.net/v2.0'
    MEDIAFILES_SWIFT_USERNAME: '8G5tWbKsvRF5'
    MEDIAFILES_SWIFT_TENANT_NAME: '4225868752343946'
    MEDIAFILES_SWIFT_REGION_NAME: 'GRA1'
    MEDIAFILES_SWIFT_KEY: 'BfZrTn5N6ZmnUDwSaYb7d8StEHdQjBWj'
    MEDIAFILES_SWIFT_CONTAINER_NAME: 'daniel_testing_file_uploads_from_ocim' # â†’ https://storage.gra1.cloud.ovh.net/v1/AUTH_d63f739f98604cb799e584eebbb6057d/daniel_testing_file_uploads_from_ocim/
    TEST_RUNNER: 'opencraft.tests.utils.CircleCIParallelTestRunner'
    WATCH_FORK: 'open-craft/edx-platform'
    WATCH_ORGANIZATION: 'open-craft'
dependencies:
  pre:
    - pip install --upgrade pip
    - pip install --upgrade virtualenv
    # Update python to latest 2.6.* release from the deadsnakes PPA.
    # Ubuntu 14.04 which we currently use on CircleCI comes with 2.7.6 preinstalled,
    # which does not support SNI. When CircleCI starts providing Ubuntu 16.04 images,
    # this won't be needed anymore.
    - sudo add-apt-repository ppa:fkrull/deadsnakes-python2.7 -y
    - sudo apt-get update; sudo apt-get install python2.7 python2.7-dev
  override:
    - pip install -r requirements.txt
database:
  override:
    - make create_db
test:
  override:
    - bin/run-circleci-tests:
        timeout: 2800
        parallel: true
  post:
    - make test_integration_cleanup:
        timeout: 1200
